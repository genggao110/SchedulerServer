<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Model Resource Info</title>

    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">

    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/list.css">
    <link rel="stylesheet" href="/static/css/model_items.css">
    <link rel="stylesheet" href="/static/css/common/navbar.css">
    <link rel="stylesheet" href="/static/css/wzhStyle.css">
    <link rel="stylesheet" href="/static/css/wzhFlexContainer.css">
    <link rel="stylesheet" href="/static/css/common/styles.9694af830a714e8db8b1.css">
    <link rel="stylesheet" href="/static/css/font-awesome/fonts/fontawesome-webfont.woff">
    <link rel="stylesheet" href="/static/css/font-awesome/fonts/fontawesome-webfont.ttf">
    <script src="/static/js/common/vue.min.js"></script>
    <script src="/static/js/common/vue-avatar.min.js"></script>
    <script src="/static/element-ui/index.js"></script>
    <link rel="stylesheet" href="/static/element-ui/theme-chalk/index.css">


    <style>
        .el-menu a{
            color:white;
        }
        body{
            margin: 0;
        }

        .badge {
            padding: 5px 7px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .serverCard{
            margin:15px 0;
            padding:0 15px;
            border-top:8px solid #373D41;
        }

        .serverCard .content{
            padding:10px 0 0 0;
        }

        .serverCard:hover{
            border-top: 8px solid #00C1DE;
        }
    </style>
    <link rel="stylesheet" href="/static/css/font-awesome/css/font-awesome.css">


</head>
<body>
<div id="app">

    <div th:replace="fragments/navbar :: menu"></div>
    <div style="padding: 24px;">
        <el-page-header title = "Back" content="Model Resource Info" @back="window.location.href='/list/model'">
        </el-page-header>
    </div>

    <div class="el-col-12" style="height:700px">
        <el-card style="margin: 10px 0 10px 10px;">

            <div class="modelPanel">
                <div class="content-body">
                    <div v-cloak class="list-item" style="border:none">
                        <div class="detail_title">
                            <a href="javascript:void(0);"
                               target="_blank">{{modelResourceInfo.name}}</a>
                            <el-tag v-if="modelResourceInfo.contentType=='Package'" type="warning">Package</el-tag>
                            <el-tag v-if="modelResourceInfo.contentType=='Service'" type="success">Service</el-tag>

                            <el-button type="success" class="pull-right" @click="openDeployDialog()">Deploy</el-button>
                            <el-button v-if="modelResourceInfo.type==1" type="primary" class="pull-right" style="margin-right: 10px">Invoke</el-button>
                        </div>
                        <el-dialog title="Deploy" :visible.sync="deployDialog" width="75%" class="" top="10vh" center>
                            <div class="flexCol flexAlignCenter" style="margin-top:-20px;margin-bottom: 15px ">
                                <h3 _ngcontent-pnd-c16="" class="f3-light mb-1">Apart from your own resources,</h3>
                                <h3 _ngcontent-pnd-c16="" class="f3-light mb-1">We have provided sevaral Computable Resources for you to use, </h3>
                                <h3 _ngcontent-pnd-c16="" class="f3-light mb-1">and you can invite more users to participate your project.</h3>
                            </div>
                            <div class="flexRow flexAlignCenter" style="height: 50vh">
                                <div class="flexCol flexJustCenter" style="width: 28%;height: 100%;">
                                    <h4 style="margin: 5px auto">Participant Users</h4>
                                    <div class="overflow-scroll">
                                        <el-table

                                                :show-header="false"
                                                :data="tableData1"
                                                style="width: 100%">
                                            <el-table-column style="text-align: right;" width="100">
                                                <template slot-scope="scope">
                                                    <img style="border-radius: 50%;height:40px;width:40px;border: 1px solid #C0C4CC;"
                                                         src="/static/img/icon/default.png">
                                                </template>
                                            </el-table-column>
                                            <el-table-column>
                                                <template slot-scope="scope">

                                                    {{ scope.row.name }}

                                                </template>
                                            </el-table-column>
                                        </el-table>
                                        <!--    invite的user -->
                                        <el-table
                                                v-if = "chosenUser.length>0"
                                                :show-header="false"
                                                :data="chosenUser"
                                                style="width: 100%">
                                            <el-table-column style="" width="100">
                                                <template slot-scope="scope">
                                                    <img style="border-radius: 50%;height:40px;width:40px;border: 1px solid #C0C4CC;"
                                                         src="/static/img/icon/default.png">
                                                </template>
                                            </el-table-column>
                                            <el-table-column >
                                                <template slot-scope="scope" >

                                                    {{ scope.row.name }}

                                                </template>
                                            </el-table-column>
                                            <el-table-column>
                                                <template slot-scope="scope">
                                                    <el-button type="primary" @click="cancelInvite(scope.row)">
                                                        Cancel
                                                    </el-button>
                                                </template>

                                            </el-table-column>
                                        </el-table>
                                    </div>

                                    <div class="flexCenter" style="flex: 1;">
                                        <h3 class="noMargin" style="margin-right:10px ">Invite User</h3>
                                        <div class="circleSmall flexCenter" @click="showAllUser">
                                            <i class="fa fa-plus" aria-hidden="true" style="font-size: 15px"></i>
                                        </div>

                                    </div>

                                </div>
                                <div class="innerBorderCol"></div>
                                <div class="flexCol" style="width: 72%;max-height: 405px;">
                                    <h4 style="margin: 5px auto">Computable Resource</h4>
                                    <div class="flexCol overflow-scroll" style="height: 366px">
                                        <!--                        所有可以使用-->
                                        <div>
                                            <div class="col-sm-12 col-md-6 col-lg-4" v-if="modelContainerUse.length!=0"
                                                 v-for="(container,index) in modelContainerUse">
                                                <el-card class="box-card serverCard" style="cursor: pointer"
                                                         @click.native="chooseResource($event,container)">
                                                    <div class="content">
                                                        <div class="clearfix">
                                                            <div class="pull-left">
                                                                <h4 style="margin-bottom: 10px;font-weight: bold">
                                                                    {{container.hostName}}

                                                                </h4>
                                                                <p style="margin-bottom:5px">{{container.software_info.os}}
                                                                    {{container.software_info.osVersion}}</p>
                                                                <p>{{container.hardware_info.staticInfo.cpu_core}} Core -
                                                                    {{container.hardware_info.staticInfo.memory_size}} RAM -
                                                                    {{container.hardware_info.staticInfo.disk_all}} Hard
                                                                    Disk</p>
                                                            </div>
                                                        </div>
                                                        <div class="clearfix">
                                                            <div class="serverStatus pull-left">
                                                                <a>
                                                                    <img src="/static/img/icon/default.png"
                                                                         class="round_icon"
                                                                         style="margin-top:-5px;width:20px;height: 20px;display: inline-block;border:1px solid #ccc;border-radius: 50%">
                                                                </a>

                                                                <a @click="open"
                                                                   style="display: inline-block;margin-left: 5px;font-size:15px;">
                                                                    <h4>
                                                                        {{container.userId}}</h4></a>
                                                            </div>
                                                            <div class="serverIp pull-right"
                                                                 style="color:red;font-size: 20px">
                                                                <!--{{container.score}}-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </el-card>
                                            </div>
                                        </div>

                                        <div class="flexRow" style="margin-top: 30px">
                                            <div class="innerBorder" style="width: 25%"></div>
                                            <h4 style="font-weight: 400;color: #999999">If all invites accepted, more resources you can use:</h4>
                                            <div class="innerBorder" style="width: 25%"></div>
                                        </div>
                                        <!--                        等待接受-->
                                        <div>
                                            <div class="col-sm-12 col-md-6 col-lg-4"
                                                 v-if="modelContainerListInviting.length!=0"
                                                 v-for="(container,index) in modelContainerListInviting">
                                                <el-card class="box-card serverCard">
                                                    <div class="content">
                                                        <div class="clearfix">
                                                            <div class="pull-left">
                                                                <h4 style="margin-bottom: 10px;font-weight: bold">
                                                                    {{container.hostName}}

                                                                </h4>
                                                                <p style="margin-bottom:5px">{{container.software_info.os}}
                                                                    {{container.software_info.osVersion}}</p>
                                                                <p>{{container.hardware_info.staticInfo.cpu_core}} Core -
                                                                    {{container.hardware_info.staticInfo.memory_size}} RAM -
                                                                    {{container.hardware_info.staticInfo.disk_all}} Hard
                                                                    Disk</p>
                                                            </div>
                                                        </div>
                                                        <div class="clearfix">
                                                            <div class="serverStatus pull-left">
                                                                <a>
                                                                    <img src="/static/img/icon/default.png"
                                                                         class="round_icon"
                                                                         style="margin-top:-5px;width:20px;height: 20px;display: inline-block;border:1px solid #ccc;border-radius: 50%">
                                                                </a>

                                                                <a @click="open"
                                                                   style="display: inline-block;margin-left: 5px;font-size:15px;">
                                                                    <h4>
                                                                        {{container.userId}}</h4></a>
                                                            </div>
                                                            <div class="serverIp pull-right"
                                                                 style="color:red;font-size: 20px">
                                                                <!--{{container.score}}-->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </el-card>
                                            </div>
                                            <h3 class="f3-light mb-1" v-if="modelContainerListInviting.length==0"
                                                style="text-align: center;margin-top: 50px">Find no computable resource</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span slot="footer" class="dialog-footer">
                                <el-button type="primary" @click="creatDeployProject">
                                    Confirm
                                </el-button>
                                 <el-button @click="deployDialog=false">
                                    Cancel
                                </el-button>
                            </span>
                        </el-dialog>
                        <el-dialog title="Invite user" :visible.sync="userChooseDialog" width="40%" center>
                            <div class="flexCol flexAlignCenter" style="margin-top:-15px;margin-bottom: 15px ">
                                <h3 _ngcontent-pnd-c16="" class="f3-light mb-1">Once he/she accept your request,</h3>
                                <h3 _ngcontent-pnd-c16="" class="f3-light mb-1">you can use his/her computable resource.</h3>
                            </div>
                            <div style="max-height:350px;overflow-y: scroll ">
                                <el-table

                                        :show-header="false"
                                        :data="userAll"
                                        style="width: 100%">
                                    <el-table-column style="" width="80">
                                        <template slot-scope="scope">
                                            <img style="border-radius: 50%;height:40px;width:40px;border: 1px solid #C0C4CC;"
                                                 src="/static/img/icon/default.png">
                                        </template>
                                    </el-table-column>
                                    <el-table-column width="180">
                                        <template slot-scope="scope" >

                                            <el-tag size="medium">{{ scope.row.email }}</el-tag>

                                        </template>
                                    </el-table-column>
                                    <el-table-column width="180">
                                        <template slot-scope="scope" >

                                            {{ scope.row.name }}

                                        </template>
                                    </el-table-column>
                                    <el-table-column>
                                        <template slot-scope="scope">
                                            <el-button type="primary" @click="inviteUser(scope.row)">
                                                Invite
                                            </el-button>
                                        </template>

                                    </el-table-column>
                                </el-table>
                                <el-table

                                        :show-header="false"
                                        :data="userAll"
                                        style="width: 100%">
                                    <el-table-column style="" width="80">
                                        <template slot-scope="scope">
                                            <img style="border-radius: 50%;height:40px;width:40px;border: 1px solid #C0C4CC;"
                                                 src="/static/img/icon/default.png">
                                        </template>
                                    </el-table-column>
                                    <el-table-column width="180">
                                        <template slot-scope="scope" >

                                            <el-tag size="medium">{{ scope.row.email }}</el-tag>

                                        </template>
                                    </el-table-column>
                                    <el-table-column width="180">
                                        <template slot-scope="scope" >

                                            {{ scope.row.name }}

                                        </template>
                                    </el-table-column>
                                    <el-table-column>
                                        <template slot-scope="scope">
                                            <el-button type="primary" @click="inviteUser(scope.row)">
                                                Invite
                                            </el-button>
                                        </template>

                                    </el-table-column>
                                </el-table
>
                            </div>
                            <span slot="footer" class="dialog-footer">
                                <el-button type="primary" @click="userChooseDialog=false">
                                    Confirm
                                </el-button>
                                <el-button @click="userChooseDialog=false">
                                    Cancel
                                </el-button>


                            </span>


                        </el-dialog>
                        <div>
                            <div class="detail_overview">
                                <a class="img" :href="'https://geomodeling.njnu.edu.cn/user/'+ modelResourceInfo.author_oid" target="_blank">
                                    <avatar v-if="modelResourceInfo.image==''" :username="modelResourceInfo.name" :size="90"
                                            :rounded="false"></avatar>
                                    <img v-if="modelResourceInfo.image!=''" :src="modelResourceInfo.image"
                                         style="width:90px;height: 90px;">

                                </a>

                                <div class="info">
                                    <p :style="{'-webkit-line-clamp':4}">{{modelResourceInfo.description}}</p>
                                    <div class="tags">
                                        <span class="badge badge-info" >Computable Model</span>
                                        <span class="badge badge-info" v-if="modelResourceInfo.contentType=='Package'">Model Service Package</span>
                                        <span class="badge badge-info" v-if="modelResourceInfo.contentType=='Service'">Service</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>
                        <div class="detail_bottom">
                            <div style="display:inline-block;float: left;">
                                <a :href="'https://geomodeling.njnu.edu.cn/user/'+ modelResourceInfo.author_oid">
                                    <img :src="modelResourceInfo.image==''?'/static/img/icon/default.png':modelResourceInfo.image"
                                         class="round_icon"
                                         style="margin-top:-5px;width:30px;height: 30px;display: inline-block;">
                                </a>

                                <a :href="'https://geomodeling.njnu.edu.cn/user/'+ modelResourceInfo.author_oid" target="_blank"
                                   style="display: inline-block;margin-left: 5px;"><h4>
                                    {{modelResourceInfo.author_name}}</h4></a>

                                <h4 class="screen_view">
                                    contributed at {{createTime}} </h4>
                                <h4 class="mobile_view">
                                    {{createTime}} </h4>
                            </div>
                            <div class="detail_option">
                                <a class="fa fa-eye" aria-hidden="true"></a>&nbsp&nbsp{{modelResourceInfo.viewCount}}
                                <!--<a href="javascript:void(0)" class="fa fa-thumbs-o-up" aria-hidden="true"></a>&nbsp&nbsp{{modelItem.thumbsUpCount}}-->
                            </div>
                            <br>
                        </div>
                    </div>

                </div>

            </div>
        </el-card>
        <el-card style="margin: 10px 0 10px 10px;">
            <div slot="header" class="clearfix" style="text-align: center;font-size: 20px;font-weight: bold;">
                <span>Detailed Description</span>
            </div>
            <div id="detail" class="detailIntroducePanel" v-html="modelResourceInfo.detail">
            </div>
        </el-card>

    </div>

    <div class="el-col-12" style="height:700px;padding-left:10px">
        <el-card style="margin: 10px 10px 10px 0;">
            <div slot="header" class="clearfix" style="text-align: center;font-size: 20px;font-weight: bold;">
                <span>Resource</span>
            </div>
            <div class="block_content" style="margin-right: 0;">
                <div class="el-card filecontent is-always-shadow" id="browsercont" style="overflow-y: auto;">
                    <div class="el-card dataitemisol is-never-shadow"
                         shadow="never"
                         style="width: 150px;">
                        <a target="_blank" :href="modelResourceInfo.packagePath" style="color: black">
                            <div class="el-card__body">
                                <div class="el-row">
                                    <div class="el-col el-col-6">&nbsp;</div>
                                    <div class="el-col el-col-12">
                                        <img
                                                :src="'/static/img/filebrowser/'+ resources.suffix + '.svg'"
                                                onerror="javascript:this.src='/static/img/filebrowser/unknow.svg'"
                                                style="width: 100%;">
                                    </div>
                                    <div class="el-col el-col-6">&nbsp;</div>
                                </div>
                                <div class="el-row" style="height: 45px">
                                    <div class="el-col el-col-2"></div>
                                    <div class="el-col el-col-20">
                                        <p style="overflow: hidden;overflow-wrap: break-word; word-break: break-all; text-align: center;display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;line-height: 1.5">
                                            {{resources.name}}
                                        </p>
                                    </div>
                                    <div class="el-col el-col-2">&nbsp;</div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </el-card>

        <el-card style="margin: 10px 10px 10px 0;">
            <div slot="header" class="clearfix" style="text-align: center;font-size: 20px;font-weight: bold;">
                <span>Environment</span>
            </div>
            <table id="runtime_table" class="table table-bordered text-center" v-if="oldtableStatus">
                <thead>
                <tr>
                    <th class="text-center">Type</th>
                    <th class="text-center">Property</th>
                    <th class="text-center">Value</th>
                </tr>
                </thead>
                <tbody>
                <div >
                    <tr >
                        <td rowspan="4">Basic Info</td>
                        <td>name</td>
                        <td>{{oldtableData.name}}</td>
                    </tr>
                    <tr >
                        <td>version</td>
                        <td>{{oldtableData.version}}</td>
                    </tr>
                    <tr >
                        <td>baseDir</td>
                        <td>{{oldtableData.baseDir}}</td>
                    </tr>
                    <tr >
                        <td>entry</td>
                        <td>{{oldtableData.entry}}</td>
                    </tr>
                </div>
                <div v-if="oldtableData.hardware.length != 0">
                    <tr v-for="(hardware,index) in oldtableData.hardware">
                        <td v-if="index == 0" :rowspan="oldtableData.hardware.length">HardwareDependencies</td>
                        <td>{{hardware.name}}</td>
                        <td>{{hardware.value}}</td>
                    </tr>
                </div>
                <div v-if="oldtableData.software.length != 0">
                    <tr v-for="(software, index) in oldtableData.software">
                        <td v-if="index == 0" :rowspan="oldtableData.software.length">SoftwareDependencies</td>
                        <td>{{software.name}}</td>
                        <td>{{oldSoftwareHandle(software)}}</td>
                    </tr>
                </div>
                <div v-if="oldtableData.assemblies.length != 0">
                    <tr v-for="(assembly, index) in oldtableData.assemblies">
                        <td v-if="index == 0" :rowspan="oldtableData.assemblies.length">Assemblies</td>
                        <td>{{assembly.name}}</td>
                        <td>{{assembly.path}}</td>
                    </tr>
                </div>
                <div v-if="oldtableData.support.length != 0">
                    <tr v-for="(support, index) in oldtableData.support">
                        <td v-if="index == 0" :rowspan="oldtableData.support.length">SupportiveResources</td>
                        <td>{{support.type}}</td>
                        <td>{{support.name}}</td>
                    </tr>
                </div>
                </tbody>
            </table>

            <table class="table table-bordered text-center" id="runtime_table2" v-if="!oldtableStatus">
                <thead>
                <tr>
                    <th class="text-center">Type</th>
                    <th class="text-center">Property</th>
                    <th class="text-center">Value</th>
                </tr>
                </thead>
                <tbody>
                <div>
                    <tr>
                        <td rowspan="5">Basic Info</td>
                        <td>name</td>
                        <td>{{tableData.name}}</td>
                    </tr>
                    <tr>
                        <td>version</td>
                        <td>{{tableData.version}}</td>
                    </tr>
                    <tr>
                        <td>baseDir</td>
                        <td>{{tableData.baseDir}}</td>
                    </tr>
                    <tr>
                        <td>entry</td>
                        <td>{{tableData.entry}}</td>
                    </tr>
                    <tr>
                        <td>platform</td>
                        <td>{{tableData.platform}}</td>
                    </tr>
                </div>
                <div v-if="tableData.hardware.length != 0">
                    <tr v-for="(hardware,index) in tableData.hardware">
                        <td v-if="index == 0" :rowspan="tableData.hardware.length">HardwareDependencies</td>
                        <td>{{hardware.name}}</td>
                        <td>{{hardware.value}}</td>
                    </tr>
                </div>
                <div v-if="tableData.software.length != 0">
                    <tr v-for="(software, index) in tableData.software">
                        <td v-if="index == 0" :rowspan="tableData.software.length">SoftwareDependencies</td>
                        <td>{{software.name}}</td>
                        <td>{{softwareHandle(software)}}</td>
                    </tr>
                </div>
                <div v-if="tableData.assemblies.length != 0">
                    <tr v-for="(assembly, index) in tableData.assemblies">
                        <td v-if="index == 0" :rowspan="tableData.assemblies.length">Assemblies</td>
                        <td>{{assembly.name}}</td>
                        <td>{{assembly.path}}</td>
                    </tr>
                </div>
                </tbody>
            </table>
        </el-card>
    </div>

    <div class="el-col-lg-offset-2 el-col-20" style="margin-top: 20px;margin-bottom: 20px">

    </div>
    <script th:inline="javascript">
        var oid = [[${oid}]];
        console.log(oid);
    </script>

</div>

</body>

<script src="/static/js/common/jquery-3.3.1.min.js"></script>
<script src="/static/js/common/bootstrap.min.js"></script>
<script src="/static/element-ui/index.js"></script>
<script src="/static/element-ui/umd/locale/en.js"></script>
<script src="/static/js/common/navbar.js"></script>
<script src="/static/js/model_info.js"></script>
</html>